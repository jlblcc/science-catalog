#!/usr/bin/env node

let command = require('commander'),
    fs = require('fs'),
    db = require('../db'),
    Project = require('../db/models/Project'),
    handleError = (err) => {
        console.error(err);
        process.exit(1);
    };

command.version('0.0.0')
    .option('-f, --file <file>','mdJson')
    .option('-t --title <title>','Project title')
    .parse(process.argv);

if(!command.file || !command.title) {
    command.help();
}

db()
  .then(() => {
      fs.readFile(command.file,'utf8',(err,data) => {
          if(err) {
              return handleError(err);
          }
          let json = JSON.parse(data);
          (new Project({
              title: command.title,
              mdJson: json
          })).save()
            .then(o => {
                console.log(`inserted ${o._id} "${o.title}"`);
                process.exit(0);
            })
            .catch(handleError);
      });
  })
  .catch(handleError);
